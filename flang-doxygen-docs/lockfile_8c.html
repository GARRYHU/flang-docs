<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>flang: lockfile.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">flang<span id="projectnumber">&#160;15.0.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_14be6b023eeb2d44a9dc7aa73d512abe.html">scutil</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">lockfile.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="lockfile_8h_source.html">lockfile.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for lockfile.c:</div>
<div class="dyncontent">
<div class="center"><img src="lockfile_8c__incl.png" border="0" usemap="#alockfile_8c" alt=""/></div>
<map name="alockfile_8c" id="alockfile_8c">
<area shape="rect" title=" " alt="" coords="329,5,403,32"/>
<area shape="rect" title=" " alt="" coords="5,80,73,107"/>
<area shape="rect" title=" " alt="" coords="98,80,157,107"/>
<area shape="rect" title=" " alt="" coords="181,80,242,107"/>
<area shape="rect" title=" " alt="" coords="266,80,357,107"/>
<area shape="rect" title=" " alt="" coords="381,80,461,107"/>
<area shape="rect" title=" " alt="" coords="485,80,549,107"/>
<area shape="rect" title=" " alt="" coords="573,80,639,107"/>
<area shape="rect" href="lockfile_8h.html" title=" " alt="" coords="663,80,738,107"/>
</map>
</div>
</div>
<p><a href="lockfile_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lockfile_8c.html#a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6">__pg_make_lock_file</a> (char *dir)</td></tr>
<tr class="memdesc:a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a uniquely-named file in the current directory.  <a href="lockfile_8c.html#a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6">More...</a><br /></td></tr>
<tr class="separator:a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66c9acc1190d3eb5a6790f72a0867674"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rdst_8c.html#a501bf1c442d75257d5200167b3d6781e">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lockfile_8c.html#a66c9acc1190d3eb5a6790f72a0867674">__pg_get_lock</a> (char *lname)</td></tr>
<tr class="memdesc:a66c9acc1190d3eb5a6790f72a0867674"><td class="mdescLeft">&#160;</td><td class="mdescRight">The argument is the name of the lock.  <a href="lockfile_8c.html#a66c9acc1190d3eb5a6790f72a0867674">More...</a><br /></td></tr>
<tr class="separator:a66c9acc1190d3eb5a6790f72a0867674"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a186f35e1b2ee291978a5d1b0821cb591"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rdst_8c.html#a501bf1c442d75257d5200167b3d6781e">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lockfile_8c.html#a186f35e1b2ee291978a5d1b0821cb591">__pg_release_lock</a> (char *lname)</td></tr>
<tr class="memdesc:a186f35e1b2ee291978a5d1b0821cb591"><td class="mdescLeft">&#160;</td><td class="mdescRight">The argument is the same name for the lock.  <a href="lockfile_8c.html#a186f35e1b2ee291978a5d1b0821cb591">More...</a><br /></td></tr>
<tr class="separator:a186f35e1b2ee291978a5d1b0821cb591"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a546ec615d29878984f6c3f7f8894632d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rdst_8c.html#a501bf1c442d75257d5200167b3d6781e">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lockfile_8c.html#a546ec615d29878984f6c3f7f8894632d">__pg_delete_lock_file</a> ()</td></tr>
<tr class="memdesc:a546ec615d29878984f6c3f7f8894632d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up by deleting the uniquely named file we had created earlier.  <a href="lockfile_8c.html#a546ec615d29878984f6c3f7f8894632d">More...</a><br /></td></tr>
<tr class="separator:a546ec615d29878984f6c3f7f8894632d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:adc52ecb713839400e57e6a5d17e9728b"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lockfile_8c.html#adc52ecb713839400e57e6a5d17e9728b">uname</a> = <a class="el" href="ftnncharsup_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td></tr>
<tr class="separator:adc52ecb713839400e57e6a5d17e9728b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56f59f445dbd0d8e21f98752ae6c9565"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lockfile_8c.html#a56f59f445dbd0d8e21f98752ae6c9565">udir</a> = <a class="el" href="ftnncharsup_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td></tr>
<tr class="separator:a56f59f445dbd0d8e21f98752ae6c9565"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c863b82089842d2bdc24f52f6820d1"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lockfile_8c.html#a02c863b82089842d2bdc24f52f6820d1">uwaiting</a></td></tr>
<tr class="separator:a02c863b82089842d2bdc24f52f6820d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a546ec615d29878984f6c3f7f8894632d" name="a546ec615d29878984f6c3f7f8894632d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a546ec615d29878984f6c3f7f8894632d">&#9670;&nbsp;</a></span>__pg_delete_lock_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rdst_8c.html#a501bf1c442d75257d5200167b3d6781e">void</a> __pg_delete_lock_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="rdst_8c.html#a501bf1c442d75257d5200167b3d6781e">void</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up by deleting the uniquely named file we had created earlier. </p>
<p >These routines only allow one lock to be managed at a time. They dynamically allocate and free memory. </p>

<p class="definition">Definition at line <a class="el" href="lockfile_8c_source.html#l00179">179</a> of file <a class="el" href="lockfile_8c_source.html">lockfile.c</a>.</p>

<p class="reference">References <a class="el" href="ftncharsup_8c_source.html#l00022">NULL</a>, <a class="el" href="cis__common_8h_source.html#l00072">r</a>, <a class="el" href="lockfile_8c_source.html#l00056">udir</a>, and <a class="el" href="lockfile_8c_source.html#l00055">uname</a>.</p>

</div>
</div>
<a id="a66c9acc1190d3eb5a6790f72a0867674" name="a66c9acc1190d3eb5a6790f72a0867674"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66c9acc1190d3eb5a6790f72a0867674">&#9670;&nbsp;</a></span>__pg_get_lock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rdst_8c.html#a501bf1c442d75257d5200167b3d6781e">void</a> __pg_get_lock </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>lname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The argument is the name of the lock. </p>
<p >Each process tries to create a hard link with this name to its own uniquely-named file from <a class="el" href="lockfile_8h.html#a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6" title="Creates a uniquely-named file in the current directory.">__pg_make_lock_file()</a>. The one that succeeds is the new lock owner. The others fail and try again. There is a fail-over to handle the case where the process with the lock dies, which is inherently unsafe, but we haven't come up with a better solution. </p>

<p class="definition">Definition at line <a class="el" href="lockfile_8c_source.html#l00099">99</a> of file <a class="el" href="lockfile_8c_source.html">lockfile.c</a>.</p>

<p class="reference">References <a class="el" href="pstride_8c_source.html#l00042">count</a>, <a class="el" href="tempnam_8c.html#ae1f8d7cced8bc99ade6dbad21b427331">malloc()</a>, <a class="el" href="ftncharsup_8c_source.html#l00022">NULL</a>, <a class="el" href="cis__common_8h_source.html#l00072">r</a>, <a class="el" href="func_8c.html#ac410d7e124a04b9beab455f26468bfad">ss</a>, <a class="el" href="f90alloc_8h_source.html#l00016">stat</a>, <a class="el" href="pgnewfil_8c.html#abee7506e829c732c2f723ed28cfc3f73">strlen()</a>, <a class="el" href="lockfile_8c_source.html#l00056">udir</a>, <a class="el" href="lockfile_8c_source.html#l00055">uname</a>, and <a class="el" href="lockfile_8c_source.html#l00061">uwaiting</a>.</p>

</div>
</div>
<a id="a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6" name="a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f6ec4a9c46dfd2ebfbb1fbe22e3f4a6">&#9670;&nbsp;</a></span>__pg_make_lock_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __pg_make_lock_file </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a uniquely-named file in the current directory. </p>
<p >To work, this must be created on the same filesystem as the file which we are attempting to lock. If there are multiple processes running each competing for the same lock, each gets a unique file here. </p>

<p class="definition">Definition at line <a class="el" href="lockfile_8c_source.html#l00067">67</a> of file <a class="el" href="lockfile_8c_source.html">lockfile.c</a>.</p>

<p class="reference">References <a class="el" href="stdioInterf_8h.html#a6441bf0a1040701d1ba906b64f348daf">fclose()</a>, <a class="el" href="getfileinfoqqi83f_8c_source.html#l00023">FILE</a>, <a class="el" href="tempnam_8c.html#ae1f8d7cced8bc99ade6dbad21b427331">malloc()</a>, <a class="el" href="ftncharsup_8c_source.html#l00022">NULL</a>, <a class="el" href="pgnewfil_8c_source.html#l00083">pid</a>, <a class="el" href="cis__common_8h_source.html#l00072">r</a>, <a class="el" href="pgnewfil_8c.html#abee7506e829c732c2f723ed28cfc3f73">strlen()</a>, <a class="el" href="lockfile_8c_source.html#l00056">udir</a>, <a class="el" href="lockfile_8c_source.html#l00055">uname</a>, and <a class="el" href="lockfile_8c_source.html#l00061">uwaiting</a>.</p>

</div>
</div>
<a id="a186f35e1b2ee291978a5d1b0821cb591" name="a186f35e1b2ee291978a5d1b0821cb591"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a186f35e1b2ee291978a5d1b0821cb591">&#9670;&nbsp;</a></span>__pg_release_lock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rdst_8c.html#a501bf1c442d75257d5200167b3d6781e">void</a> __pg_release_lock </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>lname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The argument is the same name for the lock. </p>
<p >The lock is released by deleting (calling unlink) for the hard link we had just created. </p>

<p class="definition">Definition at line <a class="el" href="lockfile_8c_source.html#l00159">159</a> of file <a class="el" href="lockfile_8c_source.html">lockfile.c</a>.</p>

<p class="reference">References <a class="el" href="tempnam_8c.html#ae1f8d7cced8bc99ade6dbad21b427331">malloc()</a>, <a class="el" href="ftncharsup_8c_source.html#l00022">NULL</a>, <a class="el" href="cis__common_8h_source.html#l00072">r</a>, <a class="el" href="pgnewfil_8c.html#abee7506e829c732c2f723ed28cfc3f73">strlen()</a>, <a class="el" href="lockfile_8c_source.html#l00056">udir</a>, and <a class="el" href="lockfile_8c_source.html#l00055">uname</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a56f59f445dbd0d8e21f98752ae6c9565" name="a56f59f445dbd0d8e21f98752ae6c9565"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56f59f445dbd0d8e21f98752ae6c9565">&#9670;&nbsp;</a></span>udir</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char* udir = <a class="el" href="ftnncharsup_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="lockfile_8c_source.html#l00056">56</a> of file <a class="el" href="lockfile_8c_source.html">lockfile.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="lockfile_8c_source.html#l00179">__pg_delete_lock_file()</a>, <a class="el" href="lockfile_8c_source.html#l00099">__pg_get_lock()</a>, <a class="el" href="lockfile_8c_source.html#l00067">__pg_make_lock_file()</a>, and <a class="el" href="lockfile_8c_source.html#l00159">__pg_release_lock()</a>.</p>

</div>
</div>
<a id="adc52ecb713839400e57e6a5d17e9728b" name="adc52ecb713839400e57e6a5d17e9728b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc52ecb713839400e57e6a5d17e9728b">&#9670;&nbsp;</a></span>uname</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char* uname = <a class="el" href="ftnncharsup_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="lockfile_8c_source.html#l00055">55</a> of file <a class="el" href="lockfile_8c_source.html">lockfile.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="curdir_8c_source.html#l00087">__fort_gethostname()</a>, <a class="el" href="lockfile_8c_source.html#l00179">__pg_delete_lock_file()</a>, <a class="el" href="lockfile_8c_source.html#l00099">__pg_get_lock()</a>, <a class="el" href="lockfile_8c_source.html#l00067">__pg_make_lock_file()</a>, <a class="el" href="lockfile_8c_source.html#l00159">__pg_release_lock()</a>, <a class="el" href="exterf_8c_source.html#l02221">export_symbol()</a>, <a class="el" href="interf_8c_source.html#l05218">fill_sym()</a>, <a class="el" href="interf_8c_source.html#l01943">import()</a>, <a class="el" href="stat__linux_8c_source.html#l00038">nodename()</a>, and <a class="el" href="semant_8c_source.html#l12885">wrong_name()</a>.</p>

</div>
</div>
<a id="a02c863b82089842d2bdc24f52f6820d1" name="a02c863b82089842d2bdc24f52f6820d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02c863b82089842d2bdc24f52f6820d1">&#9670;&nbsp;</a></span>uwaiting</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long uwaiting</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="lockfile_8c_source.html#l00061">61</a> of file <a class="el" href="lockfile_8c_source.html">lockfile.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="lockfile_8c_source.html#l00099">__pg_get_lock()</a>, and <a class="el" href="lockfile_8c_source.html#l00067">__pg_make_lock_file()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 4 2023 21:59:58 for flang by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
